<!DOCTYPE html>
<html>
<head>
  <title>Legalese Prototype</title>
  <!-- Load JsPsych -->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.4"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.1.0"></script>
  <script src="stims.js"></script>
  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <script>
    // Initializing jsPsych
    const jsPsych = initJsPsych({
      // adding
      show_progress_bar: true,
      on_trial_finish: function() {
    jsPsych.getDisplayElement().innerHTML = ''; // ‚Üê important!
  },
  // TO DO: instead of displaying data to participants, this should save it to osf using datapipe
  // for now, I will comment this out, since this is useful to look at when working on the experiment
      /*on_finish: function() {
        jsPsych.data.displayData();
      }*/
    });

//set up to save data for each participant
const subject_id = jsPsych.randomization.randomID(10);
const filename = `${subject_id}.csv`;




    // timeline for trials
    const timeline = [];

    // Initial instructions
    const instructions = {
      type: jsPsychInstructions,
      pages: ['<div class="content"><h2>Writing Study</h2>'+ 
        '<p>In the following screens, you will be asked to write either a fictional story or a law involving a certain crime. </p>'+
       '<p>Click Next to begin.</p></div>'

        ],
        show_clickable_nav: true, 
    };
    timeline.push(instructions);


const attentionConfirmation = {
  type: jsPsychSurveyText,
  questions: [
    {
      prompt: `
        <div class="content">
          <h2>Writing Study</h2>
          <p>It is important to pay close attention to each trial so that you write in the correct genre.  </p>
          <p> For the purposes of this experiment, we are interested in how you (as a human) understand and produce text, not how machines do. </p>
          <p> Because of that, before moving on, in the text below we would like you to promise, in your own words, that you will complete this task on your own and will not consult a language model (such as GPT). </p>
          <p><strong>Please confirm that you have read and understood these instructions:</strong></p>
        </div>
      `,
      rows: 6,
      columns: 60,
      required: true
    }
  ],
};
timeline.push(attentionConfirmation);


// This is the writing trial function.

function createWritingTrial(taskType, crimeDescription, trialNum = null, conditionLabel = null, prefill ='') {
  let taskInstruction = "";

  if (taskType === "fiction_fromscratch") {
    taskInstruction = "You are a fiction writer. You are tasked with writing a short story about someone who commits a crime and is punished for committing that crime."    
    + "<br>"
    + " Below are the specifications for the crime. Please write the story, ensuring that it sounds authentic and engaging.";
  } else if (taskType === "law_fromscratch") {
    taskInstruction = "You are a lawmaker.  You are tasked with writing a law that prohibits a certain crime, and specifies the punishment for that crime if the crime is committed."
    + "<br>"
    +"Below are the specifications for the law. Please write the law, ensuring that it sounds authentic, authoritative and legally binding.";
  } else if (taskType === "law_editing") {
    taskInstruction = "After receiving your draft, your fellow lawmakers have requested you include an additional set of specifications for the law. "
    + "<br>"
    +"Below is the full set of specifications, with new specifications in red. Please edit the law to include the full set of specifications. As before, ensure that it sounds authentic, authoritative and legally binding.";
  } else if (taskType === "fiction_editing") {
    taskInstruction = "It turns out that after writing the story, your editors have requested some additional specifications for the story. Those additional specifications are highlighted in red below."
    +"<br>"
    +"Please edit the story to incorporate those additional specifications, again ensuring that it sounds authentic and engaging.";
  }
  return {
    type: jsPsychSurveyText,
    questions: [
      {
        prompt: `
          <div style="text-align: left;">
            <p>${taskInstruction}</p>
            <p>Enter your response into the text box below. Below are the specifications for the crime:</p>
            <div style="background-color: #f0f0f0; padding: 10px; border: 1px solid #ccc;">
              ${crimeDescription}
            </div>
          </div>
        `,
        rows: 8,
        columns: 70,
        required: true,
        value: prefill
      }
    ],
    data: {
      trial_number: trialNum,
      condition: conditionLabel
    }
  };
}
// These will be used to pre-populate the text box in the second part of the editing condition
// it is not working at the moment
/*let trial2a_response = "";    
let previousResponses = {};*/

// THESE ARE THE CRIME SPECIFICATIONS
    const crime1_full = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Whoever<br>
&emsp;&bull; Entering or attempting to enter<br>
&emsp;&emsp;&bull; A bank credit union, or any savings and loan association<br>
&emsp;&emsp;&bull; With intent to commit<br>
&emsp;&emsp;&emsp;&bull; in such bank, credit union or such savings and loan association<br>
&emsp;&emsp;&emsp;&bull; Any felony<br>
&emsp;&emsp;&emsp;&emsp;&bull; affecting such bank, credit union or such savings and loan association <br>
&emsp;&emsp;&emsp;&emsp;&bull; And in violation of any statute of any statute of the united states, or any larceny <br>
<br><strong>Punishment of offense:</strong><br>
&bull; 20 years in prison
`;

    const crime2_partial = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person who<br>
&emsp;&bull; Operates a vehicle<br>
&emsp;&emsp;&bull; While under the influence of marijuana<br>
<br><strong>Punishment of offense:</strong><br>
&bull; Fine of $5000
`;

const crime2_revised = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person who<br>
&emsp;<span style="color: red;">&bull; Upon any way or in any place where the public has a right of access</span><br>
&emsp;&bull; Operates a vehicle <span style="color: red;"> or directs the operation of a vehicle</span><br>
&emsp;&emsp;&bull; While under the influence of marijuana<span style="color: red;">; or <br>
&emsp;&emsp;&bull; With a percentage, by weight, of alcohol of 8/100 or greater<br></span>
<br><strong>Punishment of offense:</strong><br>
&bull; Fine of $5000 <span style="color: red;">  and 2.5 years in prison </span>
`;

const crime3 = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person <br>
&emsp;&bull; Who trafficks in marijuana <br>
&emsp;&bull; By knowingly or intentionally:<br>
&emsp;&emsp;&bull; manufacturing, distributing, dispensing, or cultivating; or <br>
&emsp;&emsp;&bull; possessing with intent to manufacture, distribute, dispense, or cultivate; or <br>
&emsp;&emsp;&bull; By bringing into the commonwealth <br>
&emsp;&bull; A net weight of fifty pounds or more of any mixture containing marijuana <br>
<br><strong>Punishment of offense:</strong><br>
&bull; Not less than two and one-half nor more than fifteen years in prison
`;

const crime4_partial = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person <br>
&emsp;&bull; Conducts a financial transaction which involves the proceeds of unlawful activity <br>
&emsp;&emsp;&bull; With the intent to carry out specified unlawful activity; <br>
<br><strong>Punishment of offense:</strong><br>
&bull; Fine of $500,000
`;

const crime4_revised = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person <br>
&emsp;<span style="color: red;">&bull; Knowing that the property involved in a financial transaction represents the proceeds of some form of unlawful activity</span><br>
&emsp;&bull; Conducts a financial transaction which involves the proceeds of unlawful activity <br>
&emsp;&emsp;&bull; With the intent to carry out specified unlawful activity; <br>
&emsp;&emsp;<span style="color: red;">&bull;  With intent to engage in conduct constituting a violation of the Internal Revenue Code; and <br>
&emsp;&emsp;&bull; Knowing that the transaction is designed to conceal the proceeds of unlawful activity </span>
<br><strong>Punishment of offense:</strong><br>
&bull; Fine of $500,000<span style="color: red;">; or <br>
&bull; Up to 20 years in prison; or <br>
&bull; Both </span>
`;

const crime5 = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person who <br>
&emsp;&bull; Within the territorial jurisdiction of the United States <br>
&emsp;&bull; Willfully and maliciously; or while in the commission of any felony <br>
&emsp;&bull; Sets fire to or burns <br>
&emsp;&emsp;&bull; Any dwelling <br>
&emsp;&emsp;&emsp;&bull; Whether occupied or not <br>
&emsp;&emsp;&bull; OR Any structure where persons are normally present <br>
&emsp;&emsp;&bull; OR Any other structure known to be occupied <br>
<br><strong>Punishment of offense:</strong><br>
&bull; Up to 25 years in prison

`;

const crime6_partial = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person <br>
&emsp;&bull; Who willfully fails to <br>
&emsp;&emsp;&bull; pay tax <br>
<br><strong>Punishment of offense:</strong><br>
&bull; Fine of $25,000 and 1 year in prison
`;

const crime6_revised = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Any person <br>
<span style="color:red;">&emsp;&bull; Required under Title 26 to pay tax <br> </span>
&emsp;&bull; Who willfully fails to <br>
&emsp;&emsp;&bull; pay tax <br>
<span style="color:red;">&emsp;&emsp;&bull; Make tax returns <br>
&emsp;&emsp;&bull; Keep tax records <br>
&emsp;&emsp;&bull; Or supply such information <br>  
&emsp;&bull; At the times required by law or regulations <br> </span>
<br><strong>Punishment of offense:</strong><br>
&bull; Fine of $25,000 and 1 year in prison
`;

const crime7 = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Whoever <br>
&emsp;&bull; Taking an oath before a competent tribunal <br>
&emsp;&bull; In any case in which a law of the United States authorizes an oath to be administered <br>
&emsp;&bull; That he will testify that any written testimony is true <br>
&emsp;&bull; Willfully and contrary to such oath <br>
&emsp;&bull; States any material matter which he does not believe to be true <br>

<br><strong>Punishment of offense:</strong><br>
&bull; Up to 5 years in prison

`;

const crime8 = `
<strong>Requirements of guilt for offense:</strong><br>
&bull; Whoever <br>
&emsp;&bull; Corruptly <br>
&emsp;&bull; Gives, offers or promises <br>
&emsp;&emsp;&bull; Anything of value <br>
&emsp;&emsp;&bull; To any public official <br>

<br><strong>Punishment of offense:</strong><br>
&bull; Imprisonment of up to 2 years

`;

// **************************************************** TRIAL1: FICTION, FROM SCRATCH ****************************************************

// Cofirmation of role for first trial
const roleConfirmation1 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>In the following trial, you will be a <strong>fiction writer</strong> and will be asked to write a short story.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'fiction_writer';
  }
};
timeline.push(roleConfirmation1);

// trial 1
const trial1 = createWritingTrial("fiction_fromscratch", crime1_full, 1, "fiction, from scratch");
timeline.push(trial1);


//**************************************************** TRIAL2: LAW, EDITING ****************************************************

// Role confirmation for trial 2; 
const roleConfirmation2 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>On the next page you will be a <strong> lawmaker </strong> and prompted to write a law.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'lawmaker';
  }
};
timeline.push(roleConfirmation2);


//first draft 
//create a variable to store response for first part of editing condition
let trial2a_response = "";

// this is the first part, so I  use fromscratch instructions and then supply partial stimulus
const trial2a = {
  ...createWritingTrial("law_fromscratch", crime2_partial, 2, "law, editing"),
  on_finish: function(data) {
  trial2a_response = data.response.Q0;
  }
};
timeline.push(trial2a);

//revised draft
const trial2b = createWritingTrial("law_editing", crime2_revised, 2, "law, editing", trial2a_response);
timeline.push(trial2b); 


// **************************************************** TRIAL3: LAW, FROM SCRATCH ****************************************************
const roleConfirmation3 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>On the next page you will be a <strong> lawmaker </strong> and prompted to write a law.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'lawmaker';
  }
};
timeline.push(roleConfirmation3);

//trial
const trial3 = createWritingTrial("law_fromscratch", crime3, 3, "law, from scratch");
timeline.push(trial3);

// **************************************************** TRIAL 4; FICTION, EDITING ****************************************************

//role confirmation for trial 4
const roleConfirmation4 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>In the following trial, you will be a <strong> fiction writer </strong> will be asked to write a short story.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'fiction_writer';
  }
};
timeline.push(roleConfirmation4);

//partial draft first
const trial4a = createWritingTrial("fiction_fromscratch",crime4_partial, 4, "fiction, editing");
timeline.push(trial4a);

const trial4b = createWritingTrial("fiction_editing",crime4_revised, 4, "fiction, editing");
timeline.push(trial4b);

// **************************************************** TRIAL 5: STORY, FROM SCRATCH ****************************************************
const roleConfirmation5 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>In the following trial, you will be a <strong> fiction writer </strong> will be asked to write a short story.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'fiction_writer';
  }
};
timeline.push(roleConfirmation5);

// trial 5
const trial5 = createWritingTrial("fiction_fromscratch", crime5, 5, "fiction, from scratch");
timeline.push(trial5);

// **************************************************** TRIAL 6: LAW, EDITING  ****************************************************
const roleConfirmation6 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>On the next page you will be a <strong> lawmaker </strong> and prompted to write a law.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'lawmaker';
  }
};
timeline.push(roleConfirmation6);

// trial 6
//first draft 
const trial6a = createWritingTrial("law_fromscratch", crime6_partial, 6, "law, editing");
timeline.push(trial6a);

//revised draft
const trial6b = createWritingTrial("law_editing", crime6_revised, 6, "law, editing");
timeline.push(trial6b); 


// **************************************************** TRIAL 7: LAW, FROM SCRATCH  ****************************************************
const roleConfirmation7 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>On the next page you will be a <strong> lawmaker </strong> and prompted to write a law.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'lawmaker';
  }
};
timeline.push(roleConfirmation7);

// trial 7
const trial7 = createWritingTrial("law_fromscratch", crime7, 7,"law, from scratch");
timeline.push(trial7);

// **************************************************** TRIAL 8: FICTION, FROM SCRATCH  ****************************************************
const roleConfirmation8 = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div class="content">
      <h2>The next of 8 trials is about to begin.</h2>
      <p>In the following trial, you will be a <strong> fiction writer </strong> will be asked to write a short story.</p>
      <p>Please acknowledge that you understand your role by clicking the button below.</p>
    </div>
  `,
  choices: ['I understand'],
  on_finish: function(data){
    data.role_confirmed = true;
    data.role = 'fiction_writer';
  }
};
timeline.push(roleConfirmation8);

// trial 8
const trial8 = createWritingTrial("fiction_fromscratch", crime8, 8, "fiction, from scratch");
timeline.push(trial8);

    /* TODO: Shuffle the presentation order of the sentences 
    var shuffledStimuli = jsPsych.randomization.shuffle(experimentStimuli);
    // Add reading trials for each sentence
    for (let i = 0; i < experimentStimuli.length; i++) {
      let shuffledSentence = shuffledStimuli[i].sentence
      let = shuffledCondition = shuffledStimuli[i].condition
      const readingTrials = createWritingTrial("fiction", "test");
      //timeline.push(...readingTrials);
    }*/

    // Nice to tell participants they are done, thank you, etc
    const completion = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="content"><h2>Thank you!</h2>' +
                '<p>The experiment is now complete.</p>',
      choices: [' ']
    };
    timeline.push(completion);

    const save_data = {
  type: jsPsychPipe,
  action: "save",
  experiment_id: "swpGKyrwXtqr", 
  filename: filename,
  data_string: () => jsPsych.data.get().csv()
};
timeline.push(save_data);

    // This line actually runs the experiment 
    jsPsych.run(timeline);
  </script>
</body>
</html>